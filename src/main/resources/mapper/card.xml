<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mybatis.mapper.CardMapper">
<insert id ="makeCard" parameterType="java.util.Map">
  INSERT INTO CARD_QUOTE(NUM, CONTENT)
  VALUES(SEQ_CARD_NUM.NEXTVAL, #{content})
</insert>
  <!-- 홀수/짝수 번호 무작위 한 개 추출 -->
 <select id="getCard" resultType="java.util.Map">
  SELECT CONTENT
  FROM (
    SELECT CONTENT, ROW_NUMBER() OVER (ORDER BY dbms_random.value) AS row_num
    FROM CARD_QUOTE
    WHERE
      <choose>
        <when test="odd">
          MOD(NUM, 2) != 0
        </when>
        <when test="even">
          MOD(NUM, 2) = 0
        </when>
        <otherwise>
          1=1
        </otherwise>
      </choose>
  )
  WHERE row_num = 1
</select>
    <select id="usersList" resultType="java.util.Map">
    SELECT u_num, u_name, u_status, u_birth, u_age, u_manager 
    FROM users
    <where>
    <if test="u_num!=null">AND u_num=#{u_num}</if>
			<if test="gubun!=null">
				<choose>
					<when test='gubun.equals("u_name")'>
						AND u_name LIKE '%'||#{keyword}||'%'
					</when>
					<when test='gubun.equals("u_manager")'>
						AND u_manager LIKE '%'||#{keyword}||'%'
					</when>
					<when test='gubun.equals("u_status")'>
						AND u_status LIKE '%'||#{keyword}||'%'
					</when>
				</choose>
			</if>
		</where>
  </select>
  <select id="consultList" parameterType="map" resultType="map">
  SELECT
   tb_num,TO_CHAR(TB_DATE, 'YYYY-MM-DD') AS FORMATTED_DATE,tb_content,U_NAME ,tb_UNUM,tb_HOW,tb_time
FROM
    USERTALKBOARD , USERS 
WHERE
   tb_UNUM =U_NUM 
  
ORDER BY
    tb_date
  </select>
  <insert id="consultInsert" parameterType="map">
  INSERT INTO USERTALKBOARD(tb_num,tb_date,tb_how,tb_time,tb_content,tb_unum)
VALUES (SEQ_UTB_TNUM.nextval,TO_DATE(#{tb_date}, 'YYYY-MM-DD'),#{tb_how},#{tb_time},#{tb_content},#{u_num})
  </insert>
  <delete id ="consultDelete" parameterType="int">
  DELETE FROM USERTALKBOARD
  WHERE tb_num = #{value}
  </delete>
</mapper>
